<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBTI T/F ë¶„ì„ê¸° - ê²°ê³¼</title>
    <link rel="stylesheet" href="common.css">
    <style>
        body {
            background-image: url('Question_pg/Bg2.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        /* ìµœì¢… ê²°ê³¼ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        @font-face {
            font-family: 'JejuHallasan';
            src: url('fonts/JejuHallasan.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        @font-face {
            font-family: 'NanumGyuriDiary';
            src: url('fonts/ë‚˜ëˆ”ì†ê¸€ì”¨ ê·œë¦¬ì˜ ì¼ê¸°.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        .final-page {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding-top: 2rem;
        }

        .final-result {
            margin: 2rem 0;
        }

        .keyword-chart {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .keyword-category {
            margin-bottom: 1.5rem;
        }

        .keyword-category h4 {
            margin: 0 0 0.8rem 0;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .keyword-bar-container {
            display: flex;
            align-items: center;
            margin-bottom: 0.6rem;
            padding: 0.4rem 0;
        }

        .keyword-label {
            width: 120px;
            font-size: 1em;
            color: #2c3e50;
            text-align: right;
            margin-right: 1rem;
            flex-shrink: 0;
            font-weight: 600;
        }

        .keyword-bar-bg {
            flex: 1;
            height: 24px;
            background: #f8f9fa;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .keyword-bar {
            height: 100%;
            border-radius: 10px;
            position: relative;
            transition: width 0.8s ease;
        }

        .keyword-bar.t-type {
            background: linear-gradient(90deg, #ff6b6b, #ff8e53);
        }

        .keyword-bar.f-type {
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
        }

        .keyword-count {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9em;
            color: white;
            font-weight: bold;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        .tts-button {
            padding: 0.8rem 1.5rem;
            background-color: #9C27B0;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 1rem;
            transition: all 0.3s ease;
        }

        .tts-button:hover {
            background-color: #7B1FA2;
            transform: scale(1.05);
        }
        .result-flex-container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap; /* ì¶”ê°€ */
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
            max-width: 1100px;
            margin: 0 auto;
            gap: 2rem;
            box-sizing: border-box;
        }
        .final-graph-section {
            flex: 0 0 340px;
            min-width: 320px;
            max-width: 400px;
            width: 35%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-top: 2rem;
        }
        .circle-graph-box {
            width: 300px;
            margin-bottom: 0.2rem;
            margin-left: 10px;
            box-shadow: none !important;
            border: none !important;
            background: none !important;
        }
        @media (max-width: 600px) {
          .circle-graph-box {
            margin-left: 0 !important;
          }
        }
        .tf-indicator-row {
            display: flex;
            flex-direction: row;
            gap: 1.5rem;
            width: 100%;
            justify-content: flex-start;
            margin-top: 0;
            margin-bottom: 0;
        }
        .tf-indicator {
            flex: 1 1 0;
            text-align: center;
            padding: 0.12rem 0.3rem;
            border-radius: 20px;
            color: white;
            font-size: 1.1em;
            font-weight: 700;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 0.5px;
        }
        .tf-indicator.t {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
        }
        .tf-indicator.f {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            height: 20%;
        }
        .final-review-section {
            flex: 1 1 0;
            min-width: 320px;
            width: 65%;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            /* margin-top: 2rem; */
        }
        .review-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            width: 100%;
        }
        .review-tab-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 56px;
            padding: 0;
            flex: 1 1 0;
            min-width: 0;
            background: transparent;
            border: none;
            border-radius: 7px 7px 0 0;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s, background 0.2s;
            color: #fff !important;
        }
        .review-tab-btn.active {
            background: transparent;
            color: #ffd700 !important;
            transform: scale(1.12);
            z-index: 2;
        }
        .review-tab-btn:hover {
            background: transparent;
            transform: scale(1.12);
            z-index: 2;
        }
        .tab-icon {
            max-height: 90%;
            max-width: 90%;
            object-fit: contain;
            display: block;
        }
        .review-content-box {
            width: 100%;
            min-height: 220px;
            background: transparent;
            border-radius: 0 0 15px 15px;
            box-shadow: none !important;
            border: none !important;
            background-color: transparent !important;
            padding: 2rem 1.5rem;
            font-size: 1.1em;
            color: #333;
            line-height: 1.2;
        }
        @media (max-width: 900px) {
          .review-content-box {
            padding: 1.2rem 0.5rem;
            font-size: 1em;
            min-height: 160px;
            border-radius: 14px;
          }
        }
        @media (max-width: 600px) {
          .review-content-box {
            background: none !important;
            background-color: transparent !important;
            color: #fff;
            border-radius: 1px;
            min-height: 300px;
            padding: 1.2rem 0.5rem;
            font-size: 1em;
            box-shadow: none !important;
          }
        }
        @media (max-width: 600px) {
          .result-bg-box > .bg-img {
            display: none !important;
          }
        }
        .result-bg-box {
            position: relative;
            width: 60vw;
            max-width: 1000px;
            aspect-ratio: 16 / 9;
            margin: 0 auto 2rem auto;
            border-radius: 30px;
            box-shadow: 0 6px 32px rgba(0,0,0,0.18);
            overflow: hidden;
        }
        .result-bg-box .bg-img {
            width: 100%;
            height: 100%;
            /* object-fit: contain; */
            display: block;
            border-radius: 30px;
            z-index: 0;
            position: relative;
        }
        .result-bg-box .result-flex-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            padding: 4vw 3vw;
            box-sizing: border-box;
            z-index: 1;
        }
        .container, .final-page {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        @media (max-width: 900px) {
          .result-flex-container {
            flex-direction: column;
            align-items: center;
            gap: 1.2rem;
            max-width: 98vw;
          }
          .final-graph-section, .final-review-section {
            min-width: 0;
            width: 100%;
            /* margin-top: 1rem; */
            align-items: center;
          }
          .circle-graph-box {
            width: 90vw;
            max-width: 320px;
          }
          .review-content-box {
            padding: 1.2rem 0.5rem;
            font-size: 1em;
          }
          .review-tabs {
            flex-direction: row;
            gap: 0.2rem;
            width: 100%;
          }
        }
        @media (max-width: 600px) {
          .container, .final-page {
            padding: 0.2rem 0.1rem;
            min-width: 0;
            width: 100vw;
            box-sizing: border-box;
            min-height: 100vh;
            justify-content: flex-start;
            align-items: center;
          }
          #finalOneLiner > div {
            position: relative;
            display: flex !important;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 900px;
            min-width: 0;
            margin: 0 auto 2rem auto;
            padding: 0;
            box-sizing: border-box;
          }
          #finalOneLiner img {
            width: 100%;
            max-width: 900px;
            height: auto;
            display: block;
          }
          #finalOneLiner .oneliner-text {
            font-size: 1.1em;
            width: 92%;
            padding: 0.2em 0.1em;
          }
          .result-bg-box {
            width: 95vw;
            min-width: 0;
            max-width: 95vw;
            aspect-ratio: unset;
            border-radius: 8px;
            padding: 0;
            margin: 0 auto 0.5em auto;
            box-sizing: border-box;
            min-height: auto;
            background: url('Final/Black_board.png') center/cover no-repeat !important;
            background-color: rgba(0,0,0,0.10) !important;
            border-radius: 1px;
            min-height: 300px;
          }
          .result-bg-box .result-flex-container {
            position: static;
            flex-direction: column;
            align-items: center;
            padding: 0.3em 0.1em;
            gap: 0.3em;
            width: 100%;
            box-sizing: border-box;
          }
          .final-graph-section, .final-review-section {
            min-width: 0;
            width: 100%;
            margin-top: 0.2em;
            align-items: center;
            box-sizing: border-box;
          }
          .circle-graph-box {
            width: 80vw;
            max-width: 180px;
            margin: 0 auto 0.3em auto;
          }
          .tf-indicator-row {
            flex-direction: row;
            gap: 0.3rem;
            width: 100%;
            justify-content: center;
            margin-bottom: 0.2em;
          }
          .tf-indicator {
            padding: 0.5rem 0.3rem;
            font-size: 1.1em;
          }
          .review-tabs {
            flex-direction: row;
            gap: 0.1rem;
            width: 100%;
            justify-content: center;
            margin-bottom: 0.3em;
          }
          .review-tab-btn {
            font-size: 0.8em;
            height: 35px;
            min-width: 0;
            padding: 0 1px;
            flex: 1 1 0;
            box-sizing: border-box;
          }
          .review-content-box {
            padding: 0.4rem 0.1rem;
            font-size: 0.85em;
            min-width: 0;
            width: 100%;
            box-sizing: border-box;
            min-height: 120px;
          }
          .tts-button {
            width: 100%;
            margin: 0.3rem 0 0 0;
            padding: 0.5rem 0;
            font-size: 0.9em;
            box-sizing: border-box;
          }
          .start-button {
            width: 200px;
            margin: 1.5em auto 0 auto;
            font-size: 1.15em;
            padding: 0.8em 0;
            box-sizing: border-box;
            background: linear-gradient(90deg, #2196f3 0%, #1976d2 100%);
            color: #fff;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            letter-spacing: 1px;
            box-shadow: 0 4px 16px rgba(33, 150, 243, 0.18);
            cursor: pointer;
            transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
            outline: none;
            display: block;
        }
        .start-button:hover {
            background: linear-gradient(90deg, #1976d2 0%, #2196f3 100%);
            color: #fff;
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 8px 24px rgba(33, 150, 243, 0.25);
        }
        }
        @media (max-width: 600px) {
          #finalOneLiner div[style*='position: absolute'] {
            font-size: 2.2em !important;
          }
        }
        @media (max-width: 600px) {
          #finalOneLiner div[style*='position: absolute'] {
            font-size: 1.1em !important;
          }
        }
        .review-green-box {
            background: transparent;
            border-radius: 18px;
            /* padding: 1.2rem 1.2rem 1.5rem 1.2rem; */
            box-shadow: none !important;
            border: none !important;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            gap: 0.5rem;
        }
        @media (max-width: 900px) {
            .review-green-box {
                padding: 0.7rem 0.3rem 1rem 0.3rem;
                max-width: 98vw;
                border-radius: 12px;
            }
        }
        @media (max-width: 600px) {
            .review-green-box {
                padding: 0.4rem 0.1rem 0.7rem 0.1rem;
                max-width: 99vw;
                border-radius: 8px;
            }
        }
        @media (max-width: 600px) {
          .circle-graph-box {
            margin-top: 2.2rem !important;
            margin-left: -30px !important;
          }
        }
        .result-bg-box,
        .final-review-section,
        .review-green-box,
        .review-content-box {
            height: auto !important;
            max-height: none !important;
            overflow: visible !important;
        }
        /* íš¨ê³¼ì ì¸ ì†Œí†µë²• ë‚´ìš© ì „ìš© ìŠ¤íƒ€ì¼ */
        .review-content-comm {
            font-size: 1.05em !important;
            line-height: 1.0 !important;
            white-space: pre-line;
            color: #fff;
            font-family: "NanumGyuriDiary", sans-serif;
            margin: 0 !important;
            padding: 0 !important;
        }
        .review-content-comm div,
        .review-content-comm h4,
        .review-content-comm strong,
        .review-content-comm ul,
        .review-content-comm li {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
        }
        .review-content-comm ul, .review-content-comm li {
            list-style: none !important;
        }
        .review-content-comm br {
            display: none;
        }
        .review-content-box {
            overflow-y: auto !important;
            max-height: 60vh !important;
            height: auto !important;
            width: 100% !important;
            box-sizing: border-box !important;
            padding: 0.2rem 0.5rem 0.8rem 0.5rem !important;
            min-height: 120px;
        }
        .review-content-box {
            max-height: 60vh !important;
            overflow-y: auto !important;
        }
        .start-button {
            width: 200px !important;
            margin: 1.5em auto 0 auto !important;
            font-size: 1.15em !important;
            padding: 0.8em 0 !important;
            box-sizing: border-box !important;
            background: linear-gradient(90deg, #2196f3 0%, #1976d2 100%) !important;
            color: #fff !important;
            border: none !important;
            border-radius: 30px !important;
            font-weight: bold !important;
            letter-spacing: 1px !important;
            box-shadow: 0 4px 16px rgba(33, 150, 243, 0.18) !important;
            cursor: pointer !important;
            transition: background 0.3s, transform 0.2s, box-shadow 0.3s !important;
            outline: none !important;
            display: block !important;
        }
        .start-button:hover {
            background: linear-gradient(90deg, #1976d2 0%, #2196f3 100%) !important;
            color: #fff !important;
            transform: translateY(-2px) scale(1.04) !important;
            box-shadow: 0 8px 24px rgba(33, 150, 243, 0.25) !important;
        }
        .review-content-comm ul,
        .review-content-comm li {
            margin: 0 !important;
            padding: 0 !important;
            /* line-height: 1 !important; */
            line-height: 1.3;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="final-page" id="finalPage">
            <!-- <h1>ìµœì¢… ë¶„ì„ ê²°ê³¼</h1> -->
            <div id="finalOneLiner"></div>
            <div class="result-bg-box">
                <img src="Final/Black_board.png" alt="" class="bg-img">
                <div class="result-flex-container">
                    <div class="final-graph-section">
                        <div id="finalGraph"></div>
                    </div>
                    <div class="final-review-section">
                        <div class="review-green-box">
                            <div class="review-tabs">
                                <button class="review-tab-btn" id="tab-comm"><img src="Final/Effective_white.png" data-hover="Final/Effective_yellow.png" alt="ì†Œí†µë²•" class="tab-icon"></button>
                                <button class="review-tab-btn" id="tab-strength"><img src="Final/Yougood_white.png" data-hover="Final/Yougood_yellow.png" alt="ê°•ì " class="tab-icon"></button>
                                <button class="review-tab-btn" id="tab-growth"><img src="Final/Improve_white.png" data-hover="Final/Improve_yellow.png" alt="ì„±ì¥" class="tab-icon"></button>
                            </div>
                            <div class="review-content-box" id="reviewContentBox"></div>
                        </div>
                    </div>
                </div>
            </div>
            <button onclick="location.href='index1.html'" class="start-button" style="font-family: 'HeirofBold', 'sans-serif';">ë‹¤ì‹œ ë¶„ì„í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // API ê¸°ë³¸ URL ì„¤ì •
        const API_BASE_URL = window.location.origin;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('index3.html í˜ì´ì§€ ë¡œë“œ ì‹œì‘...');
                
                const storedResults = sessionStorage.getItem('mbtiResults');
                console.log('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì½ì€ ë°ì´í„°:', storedResults);
                
                if (!storedResults) {
                    console.error('ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    alert('ë¶„ì„ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.');
                    window.location.href = 'index1.html';
                    return;
                }
                
                const results = JSON.parse(storedResults);
                console.log('íŒŒì‹±ëœ ê²°ê³¼:', results);
                
                if (!results || !results.length) {
                    console.error('ê²°ê³¼ ë°°ì—´ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.');
                    alert('ë¶„ì„ ê²°ê³¼ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•´ì£¼ì„¸ìš”.');
                    window.location.href = 'index1.html';
                    return;
                }

                console.log('ìµœì¢… ê²°ê³¼ í‘œì‹œ ì‹œì‘...');
                showFinalResult(results);
            } catch (error) {
                console.error('index3.html ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                alert('ê²°ê³¼ í˜ì´ì§€ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                window.location.href = 'index1.html';
            }
        });

        // ìµœì¢… ê²°ê³¼ í‘œì‹œ
        async function showFinalResult(results) {
            const averageScore = results.reduce((sum, r) => sum + r.score, 0) / results.length;
            const tPercentage = Math.round((100 - averageScore) / 10) * 10;
            const fPercentage = Math.round(averageScore / 10) * 10;
            
            // ê¸°ë³¸ ì •ë³´ í‘œì‹œ
            document.getElementById('finalOneLiner').innerHTML = `
                <div style="position: relative; display: inline-block; margin: 0 auto 2rem auto;">
                    <img src="Final/White_board.png" alt="ë¶„ì„ ê²°ê³¼ ì´ë¯¸ì§€" style="display: block; max-width: 100%; height: auto;">
                    <div style="
                        position: absolute;
                        top: 50%; left: 50%;
                        transform: translate(-50%, -50%);
                        width: 90%;
                        color: #333;
                        font-size: 30PX;
                        font-weight: bold;
                        text-align: center;
                        word-break: keep-all;
                        line-height: 1.3;
                        font-family: 'JejuHallasan', sans-serif;
                        ">
                        ${getFinalOneLiner(averageScore)}
                    </div>
                </div>
            `;
            
            // ê·¸ë˜í”„ í‘œì‹œ (ì›í˜• ê·¸ë˜í”„ ìƒë‹¨, T/F ì§€í‘œ í•˜ë‹¨ ê°€ë¡œ)
            document.getElementById('finalGraph').innerHTML = `
                <div class="circle-graph-box">
                    <svg width="260" height="260">
                        <circle cx="130" cy="130" r="116" fill="none" stroke="#fff" stroke-width="8"/>
                        <circle cx="130" cy="130" r="94" fill="none" stroke="#fff" stroke-width="8"/>
                        <circle cx="130" cy="130" r="105" fill="none" stroke="#f8f9fa" stroke-width="26" transform="rotate(-90 130 130)"/>
                        <circle cx="130" cy="130" r="105" fill="none" stroke="#ff6b6b" stroke-width="26" 
                                stroke-dasharray="${(100-averageScore) * 6.6} 660" stroke-linecap="round" transform="rotate(-90 130 130)"/>
                        <circle cx="130" cy="130" r="105" fill="none" stroke="#4ecdc4" stroke-width="26" 
                                stroke-dasharray="${averageScore * 6.6} 660" 
                                stroke-dashoffset="${-(100-averageScore) * 6.6}" stroke-linecap="round" transform="rotate(-90 130 130)"/>
                        <text x="130" y="130" text-anchor="middle" dominant-baseline="middle" font-size="2.5em" font-weight="bold" stroke="#fff" stroke-width="10" paint-order="stroke" fill="#2c3e50">${averageScore.toFixed(1)}%</text>
                        <text x="130" y="130" text-anchor="middle" dominant-baseline="middle" font-size="2.5em" font-weight="bold" fill="#2c3e50">${averageScore.toFixed(1)}%</text>
                        <text x="130" y="170" text-anchor="middle" dominant-baseline="middle" font-size="1.2em" font-weight="bold" fill="#fff">F-ì„±í–¥</text>
                    </svg>
                </div>
                <div class="tf-indicator-row">
                    <div class="tf-indicator f">
                        <div style="font-size: 1.1em; margin-bottom: 0.3rem;">F-ì„±í–¥</div>
                        <div style="font-size: 1.5em; font-weight: bold;">${averageScore.toFixed(1)}%</div>
                    </div>
                    <div class="tf-indicator t">
                        <div style="font-size: 1.1em; margin-bottom: 0.3rem;">T-ì„±í–¥</div>
                        <div style="font-size: 1.5em; font-weight: bold;">${(100-averageScore).toFixed(1)}%</div>
                    </div>
                </div>
            `;
            
            // finalReviewëŠ” íƒ­ êµ¬ì¡°ë¡œ ëŒ€ì²´í•˜ë¯€ë¡œ ì´ˆê¸°ì—ëŠ” ì•„ë¬´ ë‚´ìš©ë„ í‘œì‹œí•˜ì§€ ì•ŠìŒ
            document.getElementById('reviewContentBox').innerHTML = '';
            
            try {
                // AI ì¢…í•© ë¶„ì„ ìš”ì²­
                const response = await fetch(`${API_BASE_URL}/final_analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        results: results
                    })
                });

                const finalAnalysis = await response.json();
                
                // íƒ­ë³„ ë‚´ìš© ì €ì¥
                const commText = finalAnalysis.communication_strategy.replace(/\n/g, ' ');
                const commExamples = [];
                const regex = /"([^"]+)"/g;
                let match;
                while ((match = regex.exec(commText)) !== null && commExamples.length < 3) {
                    commExamples.push('"' + match[1].trim() + '"');
                }
                while (commExamples.length < 3) commExamples.push('');
                const commLines = [
                    'F ì„±í–¥ ìƒëŒ€ì™€ì˜ íš¨ê³¼ì ì¸ ì†Œí†µë²•',
                    ...commExamples
                ].slice(0, 4).join('<br>');
                window.finalReviewTabs = {
                    comm: `<div class="review-content-comm">
        <div style="font-size:1.18em; color:#ffd700; font-weight:700; margin-bottom:0.5em;">F ì„±í–¥ ìƒëŒ€ì™€ì˜ íš¨ê³¼ì ì¸ ì†Œí†µë²•</div>
        <div style="display:flex; justify-content:space-between;">
            <div>
            <div style="color:#ffd700; font-size:1.05em; font-weight:700; margin-bottom:0.0em;">[ë‚´ ë¶€ì¡±í•œ ì ]</div>
            <ul style="width: 200px; margin:0 0 0.5em 0.0em; padding:0; color:#fff; font-size:1em; font-weight:400; list-style:square outside; line-height: 1.6;">
                ${{
                    improvement_points: (finalAnalysis.improvement_points && finalAnalysis.improvement_points.length > 0)
                        ? finalAnalysis.improvement_points.map(p=>`<li style='margin-bottom:20px !important; line-height: 1.6; white-space:normal; word-break:keep-all;'>${p}</li>`).join('')
                        : '<li style="margin-bottom:20px !important; line-height: 1.6; white-space:normal; word-break:keep-all;">ê°ì • í‘œí˜„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.</li><li style="margin-bottom:20px !important;white-space:normal; word-break:keep-all;">ê³µê°ì  ë°˜ì‘ì´ ì ìŠµë‹ˆë‹¤.</li>'
                }.improvement_points}
            </ul>
            </div>

            <div>
            <div style="color:#ffd700; font-size:1.05em; font-weight:700; margin-bottom:0.2em;">[ê°œì„  íŒ]</div>
            <ul style="width: 200px; margin:0 0 0 0.0em; padding:0; color:#fff; font-size:1em; font-weight:400; list-style:square outside;">
                ${{
                    improvement_tips: (finalAnalysis.improvement_tips && finalAnalysis.improvement_tips.length > 0)
                        ? finalAnalysis.improvement_tips.map(t=>`<li style='margin-bottom:0; white-space:normal; word-break:keep-all;'>${t}</li>`).join('')
                        : '<li style=\'white-space:normal; word-break:keep-all; margin-bottom:20px !important;\'>ìƒëŒ€ì˜ ê°ì •ì„ ë¨¼ì € ì¸ì •í•´ ì£¼ì„¸ìš”.</li><li style=\'white-space:normal; word-break:keep-all; margin-bottom:20px !important;\'>ë…¼ë¦¬ì  ì„¤ëª… ì „ì— ê³µê°ì˜ ë§ì„ ê±´ë„¤ë³´ì„¸ìš”.</li><li style=\'white-space:normal; word-break:keep-all; margin-bottom:20px !important;\'>"ë„¤ê°€ ê·¸ë ‡ê²Œ ëŠê¼ˆêµ¬ë‚˜"ì™€ ê°™ì€ ë¬¸ì¥ìœ¼ë¡œ ì‹œì‘í•´ë³´ì„¸ìš”.</li>'
                }.improvement_tips}
            </ul>
            </div>
            </div>
    </div>`,
                    strength: `<div style='display:flex; flex-wrap:wrap; justify-content:center; text-align:center; gap:0.5rem; margin-top:0.5rem; font-family: "NanumGyuriDiary", sans-serif; font-size:1.25em;'>
                        ${finalAnalysis.strengths.map(strength => `<span style='display:inline-block; background:linear-gradient(90deg,#ffe066,#ffd700); color:#333; font-weight:bold; border-radius:20px; padding:0.4em 1em; font-size:1em; box-shadow:0 2px 8px rgba(255,224,102,0.15); margin-bottom:0.2em;'>#${strength.replace(/\s+/g, '')}</span>`).join('')}
                    </div>
                    <button class="tts-button" onclick="playTTS('ë‹¹ì‹ ì˜ ê°•ì ì€ ${finalAnalysis.strengths.join(", ")} ì…ë‹ˆë‹¤.')" style="margin-top:1rem; font-family: "NanumGyuriDiary", sans-serif;">ğŸ”Š ë“£ê¸°</button>`,
                    growth: `<div style='display:flex; flex-wrap:wrap; justify-content:center; text-align:center; gap:0.5rem; margin-top:0.5rem; font-family: "NanumGyuriDiary", sans-serif; font-size:1.25em;'>
    ${finalAnalysis.growth_areas.map(area => `<span style='display:inline-block; background:linear-gradient(90deg,#ffe066,#ffd700); color:#333; font-weight:bold; border-radius:20px; padding:0.4em 1em; font-size:1em; box-shadow:0 2px 8px rgba(255,224,102,0.15); margin-bottom:0.2em;'>#${area}</span>`).join('')}
</div>
<button class="tts-button" onclick="playTTS('ì„±ì¥ í¬ì¸íŠ¸ëŠ” ${finalAnalysis.growth_areas.join(", ")} ì…ë‹ˆë‹¤.')" style="margin-top:1rem; font-family: \"NanumGyuriDiary\", sans-serif;">ğŸ”Š ë“£ê¸°</button>`,
                };
                // íƒ­ ì´ë²¤íŠ¸ ë°”ì¸ë”© (JS ë¶€ë¶„)
                const tabBtns = [
                    {id: 'tab-comm', key: 'comm'},
                    {id: 'tab-strength', key: 'strength'},
                    {id: 'tab-growth', key: 'growth'}
                ];
                tabBtns.forEach(({id, key}) => {
                    const btn = document.getElementById(id);
                    btn.onclick = function() {
                        tabBtns.forEach(({id:otherId}) => document.getElementById(otherId).classList.remove('active'));
                        btn.classList.add('active');
                        document.getElementById('reviewContentBox').innerHTML = window.finalReviewTabs[key];
                    }
                });
                // ì´ˆê¸°ì—ëŠ” 'íš¨ê³¼ì ì¸ ì†Œí†µë²•' íƒ­ì„ í™œì„±í™”
                const commTab = document.getElementById('tab-comm');
                commTab.classList.add('active');
                const commImg = commTab.querySelector('img');
                if (commImg && commImg.getAttribute('data-hover')) {
                    commImg.src = commImg.getAttribute('data-hover');
                }
                document.getElementById('reviewContentBox').innerHTML = window.finalReviewTabs.comm;
                
            } catch (error) {
                console.error('Error fetching final analysis:', error);
                document.getElementById('reviewContentBox').innerHTML = `<div style='background: #f8d7da; padding: 2rem; border-radius: 15px; border-left: 5px solid #dc3545; color: #721c24;'><h3 style='margin-top:0;'>âš ï¸ ë¶„ì„ ì˜¤ë¥˜</h3><p>ì¢…í•© ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê¸°ë³¸ ë¶„ì„ ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p><div style='margin-top:1rem;'>${getFinalReview(averageScore)}</div></div>`;
            }
        }

        // ìµœì¢… í•œ ì¤„ í‰ê°€ ìƒì„± - ë” ë‹¤ì–‘í•œ í…œí”Œë¦¿
        function getFinalOneLiner(score) {
            const templates = {
                'very_t': [  // 0-20ì 
                    "ëƒ‰ì² í•œ ë…¼ë¦¬ ë¨¸ì‹ ! ê°ì •? ê·¸ê²Œ ë­”ê°€ìš”?",
                    "íŒ©íŠ¸ í­ê²©ê¸°! ë°ì´í„°ê°€ ê³§ ì§„ë¦¬ì£ ?",
                    "ì´ì„±ì˜ ì§€ë°°ì! ê°ì •ì€ ë…¼ë¦¬ ì•ì— ë¬´ë¦ ê¿‡ì–´!",
                    "ê°ê´€ì„±ì˜ ëŒ€ê°€! ê°ì • ë”°ìœ„ëŠ” ë…¼ë¦¬ ì•ì— ë¬´ë¦ ê¿‡ì–´!",
                    "ë…¼ë¦¬ì˜ ìˆ˜í˜¸ì! ê°ì •ì€ ë…¼ë¦¬ ì•ì— ë¬´ë¦ ê¿‡ì–´!"
                ],
                'strong_t': [  // 20-35ì 
                    "ë…¼ë¦¬ì  ì‚¬ê³ ì˜ ë‹¬ì¸! ê°ì •ë„ ë…¼ë¦¬ë¡œ ì •ë³µí•´ìš”",
                    "ê°ê´€ì„±ì˜ ê¸°ì‚¬! ê°ì •ë„ ë…¼ë¦¬ë¡œ ë‹¤ìŠ¤ë ¤ìš”",
                    "ì´ì„±ì˜ ê¸°ìˆ˜! ë…¼ë¦¬ë¡œ ê°ì •ë„ ì •ë³µí•´ìš”",
                    "íŒ©íŠ¸ì˜ ê¸°ì‚¬! ê°ì •ë„ ë…¼ë¦¬ë¡œ ë‹¤ìŠ¤ë ¤ìš”",
                    "ë…¼ë¦¬ì˜ ê¸°ìˆ˜! ê°ì •ë„ ë…¼ë¦¬ë¡œ ì •ë³µí•´ìš”"
                ],
                'mild_t': [  // 35-45ì 
                    "ë…¼ë¦¬ì™€ ê°ì •ì˜ ê· í˜•ì¡ëŠ” ë‹¬ì¸!",
                    "ì´ì„±ê³¼ ê°ì„±ì˜ ì¤„íƒ€ê¸° ê³ ìˆ˜!",
                    "ê°ê´€ê³¼ ì£¼ê´€ì˜ ì¡°í™”ë¡œìš´ ì¶¤ì‚¬ìœ„!",
                    "ë…¼ë¦¬ì™€ ê°ì •ì˜ ì™„ë²½í•œ ì¡°í™”!",
                    "ì´ì„±ê³¼ ê°ì„±ì˜ ê· í˜•ì¡ëŠ” ë‹¬ì¸!"
                ],
                'balanced': [  // 45-55ì 
                    "ë…¼ë¦¬ì™€ ê°ì •ì˜ ì¤„íƒ€ê¸° ë‹¬ì¸! ì–‘ë‹¤ë¦¬ ê³ ìˆ˜ë„¤ìš”~",
                    "ì´ì„±ê³¼ ê°ì„±ì˜ ì™„ë²½í•œ ê· í˜•ì¡ëŠ” ë‹¬ì¸!",
                    "ê°ê´€ê³¼ ì£¼ê´€ì˜ ì¡°í™”ë¡œìš´ ì¶¤ì‚¬ìœ„!",
                    "ë…¼ë¦¬ì™€ ê°ì •ì˜ ì™„ë²½í•œ ì¡°í™”!",
                    "ì´ì„±ê³¼ ê°ì„±ì˜ ê· í˜•ì¡ëŠ” ë‹¬ì¸!"
                ],
                'mild_f': [  // 55-65ì 
                    "ê°ì • ê³µê° ë ˆì´ë”! ëˆˆë¬¼ í•œ ë°©ìš¸ë„ ë†“ì¹˜ì§€ ì•Šì£ ?",
                    "ê³µê°ì˜ ë‹¬ì¸! ê°ì •ì„ ì½ëŠ” ë ˆì´ë”!",
                    "ê°ì„±ì˜ ê¸°ì‚¬! ê°ì •ì„ ì½ëŠ” ë‹¬ì¸!",
                    "ê³µê°ì˜ ê¸°ìˆ˜! ê°ì •ì„ ì½ëŠ” ë ˆì´ë”!",
                    "ê°ì„±ì˜ ë‹¬ì¸! ê°ì •ì„ ì½ëŠ” ê¸°ì‚¬!"
                ],
                'strong_f': [  // 65-80ì 
                    "ê°ì • ê³µê° ë ˆì´ë”! ëˆˆë¬¼ í•œ ë°©ìš¸ë„ ë†“ì¹˜ì§€ ì•Šì£ ?",
                    "ê³µê°ì˜ ë‹¬ì¸! ê°ì •ì„ ì½ëŠ” ë ˆì´ë”!",
                    "ê°ì„±ì˜ ê¸°ì‚¬! ê°ì •ì„ ì½ëŠ” ë‹¬ì¸!",
                    "ê³µê°ì˜ ê¸°ìˆ˜! ê°ì •ì„ ì½ëŠ” ë ˆì´ë”!",
                    "ê°ì„±ì˜ ë‹¬ì¸! ê°ì •ì„ ì½ëŠ” ê¸°ì‚¬!"
                ],
                'very_f': [  // 80-100ì 
                    "ì™„ì „ ê°ì„±íŒ©í† ë¦¬! ë“œë¼ë§ˆ ë³´ë‹¤ê°€ í‹°ìŠˆ ëª‡ ë°•ìŠ¤ ì¨ìš”?",
                    "ê°ì • ê³µê°ì˜ ëŒ€ê°€! ëˆˆë¬¼ í•œ ë°©ìš¸ë„ ë†“ì¹˜ì§€ ì•Šì£ ?",
                    "ê³µê°ì˜ ë§ˆìŠ¤í„°! ê°ì •ì„ ì½ëŠ” ë‹¬ì¸!",
                    "ê°ì„±ì˜ ëŒ€ê°€! ê°ì •ì„ ì½ëŠ” ë§ˆìŠ¤í„°!",
                    "ê³µê°ì˜ ë§ˆìŠ¤í„°! ê°ì •ì„ ì½ëŠ” ëŒ€ê°€!"
                ]
            };
            
            // ì ìˆ˜ êµ¬ê°„ë³„ ì¹´í…Œê³ ë¦¬ ì„ íƒ
            let category;
            if (score < 20) category = 'very_t';
            else if (score < 35) category = 'strong_t';
            else if (score < 45) category = 'mild_t';
            else if (score < 55) category = 'balanced';
            else if (score < 65) category = 'mild_f';
            else if (score < 80) category = 'strong_f';
            else category = 'very_f';
            
            // ëœë¤í•˜ê²Œ í…œí”Œë¦¿ ì„ íƒ
            return templates[category][Math.floor(Math.random() * templates[category].length)];
        }

        // ìµœì¢… ë¦¬ë·° ìƒì„± - ë” ë‹¤ì–‘í•œ í…œí”Œë¦¿
        function getFinalReview(score) {
            const reviewTemplates = {
                'very_t': [  // 0-20ì 
                    `
                        <p>ë‹¹ì‹ ì€ ë§¤ìš° ë…¼ë¦¬ì ì´ê³  ê°ê´€ì ì¸ íŒë‹¨ì„ ì„ í˜¸í•©ë‹ˆë‹¤.</p>
                        <p>ê°ì •ë³´ë‹¤ëŠ” ì‚¬ì‹¤ê³¼ ë…¼ë¦¬ì— ê¸°ë°˜í•˜ì—¬ ê²°ì •ì„ ë‚´ë¦¬ëŠ” ê²½í–¥ì´ ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, íš¨ìœ¨ì ì¸ ì˜ì‚¬ê²°ì •ì„ ì˜ í•˜ì‹¤ ê²ƒ ê°™ë„¤ìš”.</p>
                    `,
                    `
                        <p>ë§¤ìš° ë›°ì–´ë‚œ ë…¼ë¦¬ì  ì‚¬ê³  ëŠ¥ë ¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì ì´ê³  ì²´ê³„ì ì¸ ì ‘ê·¼ ë°©ì‹ì„ ì„ í˜¸í•˜ì‹œëŠ” ê²ƒ ê°™ë„¤ìš”.</p>
                        <p>íš¨ìœ¨ì„±ê³¼ ì •í™•ì„±ì„ ì¤‘ì‹œí•˜ëŠ” ì„±í–¥ì´ ê°•í•˜ê²Œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì ì´ê³  ë¶„ì„ì ì¸ ì‚¬ê³ ë°©ì‹ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ê°ì •ë³´ë‹¤ëŠ” ì‚¬ì‹¤ê³¼ ë°ì´í„°ì— ê¸°ë°˜í•œ íŒë‹¨ì„ ì„ í˜¸í•˜ì‹œë„¤ìš”.</p>
                        <p>ì²´ê³„ì ì´ê³  íš¨ìœ¨ì ì¸ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.</p>
                    `
                ],
                'strong_t': [  // 20-35ì 
                    `
                        <p>ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ë°”íƒ•ìœ¼ë¡œ í•˜ë˜, ê°ì •ì  ìš”ì†Œë„ ê³ ë ¤í•˜ì‹œëŠ” í¸ì…ë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì  íŒë‹¨ì„ ì¤‘ì‹œí•˜ì§€ë§Œ, ìƒí™©ì— ë”°ë¼ ìœ ì—°í•œ ëŒ€ì²˜ë„ ê°€ëŠ¥í•˜ì‹­ë‹ˆë‹¤.</p>
                        <p>ê· í˜• ì¡íŒ ì‚¬ê³ ë°©ì‹ì„ ê°€ì§€ê³  ìˆìœ¼ë‚˜, T ì„±í–¥ì´ ì¡°ê¸ˆ ë” ê°•í•©ë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì  ì‚¬ê³ ê°€ ìš°ì„ ì´ì§€ë§Œ, ê°ì •ì  ì¸¡ë©´ë„ ì–´ëŠ ì •ë„ ê³ ë ¤í•˜ì‹œë„¤ìš”.</p>
                        <p>ê°ê´€ì  íŒë‹¨ì„ ì¤‘ì‹œí•˜ë©´ì„œë„ ìœ ì—°í•œ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                        <p>T ì„±í–¥ì´ ê°•í•˜ì§€ë§Œ ê°ì •ì  ìš”ì†Œë„ ë°°ì œí•˜ì§€ ì•ŠëŠ” ê· í˜•ê°ì´ ìˆìŠµë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•˜ë˜, ê°ì •ì  ìš”ì†Œë„ ê³ ë ¤í•˜ëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì  íŒë‹¨ì„ ì„ í˜¸í•˜ì§€ë§Œ ìƒí™©ì— ë”°ë¼ ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <p>íš¨ìœ¨ì„±ì„ ì¤‘ì‹œí•˜ë©´ì„œë„ ê°ì •ì  ì¸¡ë©´ì„ ë¬´ì‹œí•˜ì§€ ì•ŠëŠ” ê· í˜•ê°ì´ ìˆìŠµë‹ˆë‹¤.</p>
                    `
                ],
                'mild_t': [  // 35-45ì 
                    `
                        <p>ë…¼ë¦¬ì™€ ê°ì • ì‚¬ì´ì—ì„œ ì¢‹ì€ ê· í˜•ì„ ì´ë£¨ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ë…¼ë¦¬ì  ì‚¬ê³ ë¥¼ ê¸°ë³¸ìœ¼ë¡œ í•˜ë˜, ê°ì •ì  ì¸¡ë©´ë„ ì ì ˆíˆ ê³ ë ¤í•˜ì‹œë„¤ìš”.</p>
                        <p>ê°ê´€ì  íŒë‹¨ê³¼ ê°ì •ì  ê³µê°ì˜ ì¡°í™”ë¥¼ ì˜ ì´ë£¨ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì  ì‚¬ê³ ì™€ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì´ ì˜ ì¡°í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì  íŒë‹¨ì„ ì¤‘ì‹œí•˜ë©´ì„œë„ ê°ì •ì  ì¸¡ë©´ë„ ê³ ë ¤í•˜ëŠ” ê· í˜•ê°ì´ ìˆìŠµë‹ˆë‹¤.</p>
                        <p>íš¨ìœ¨ì„±ê³¼ ê³µê° ëŠ¥ë ¥ì´ ì ì ˆíˆ ì¡°í™”ëœ ì„±í–¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì™€ ê°ì •ì˜ ê· í˜•ì„ ì˜ ì´ë£¨ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì  íŒë‹¨ê³¼ ê°ì •ì  ê³µê°ì„ ì ì ˆíˆ ì¡°ì ˆí•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤.</p>
                        <p>íš¨ìœ¨ì ì´ë©´ì„œë„ ë”°ëœ»í•œ ì ‘ê·¼ ë°©ì‹ì„ ì„ í˜¸í•˜ëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                    `
                ],
                'balanced': [  // 45-55ì 
                    `
                        <p>ë…¼ë¦¬ì™€ ê°ì • ì‚¬ì´ì—ì„œ í›Œë¥­í•œ ê· í˜•ì„ ì´ë£¨ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ìƒí™©ì— ë”°ë¼ ê°ê´€ì  íŒë‹¨ê³¼ ê°ì •ì  ê³µê°ì„ ì ì ˆíˆ ì‚¬ìš©í•˜ì‹œëŠ” ê²ƒ ê°™ë„¤ìš”.</p>
                        <p>ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ë¬¸ì œë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ ìˆìŠµë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì™€ ê°ì •ì˜ ì™„ë²½í•œ ê· í˜•ì„ ì´ë£¨ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì  íŒë‹¨ê³¼ ê°ì •ì  ê³µê°ì„ ìƒí™©ì— ë§ê²Œ ì ì ˆíˆ í™œìš©í•˜ì‹œë„¤ìš”.</p>
                        <p>ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ë¬¸ì œë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆëŠ” ë›°ì–´ë‚œ ëŠ¥ë ¥ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë…¼ë¦¬ì™€ ê°ì •ì˜ ì¡°í™”ë¡œìš´ ê· í˜•ì„ ì´ë£¨ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ìƒí™©ì— ë”°ë¼ ë…¼ë¦¬ì  ì‚¬ê³ ì™€ ê°ì •ì  ê³µê°ì„ ì ì ˆíˆ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                        <p>ê°ê´€ì  íŒë‹¨ê³¼ ê°ì •ì  ë°°ë ¤ì˜ ì™„ë²½í•œ ì¡°í™”ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                    `
                ],
                'mild_f': [  // 55-65ì 
                    `
                        <p>ê°ì •ì  ê³µê° ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ë©°, ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ì˜ ì´í•´í•˜ì‹­ë‹ˆë‹¤.</p>
                        <p>ë…¼ë¦¬ì  íŒë‹¨ë„ ê°€ëŠ¥í•˜ì§€ë§Œ, ê°ì •ì  ìš”ì†Œë¥¼ ë” ì¤‘ìš”í•˜ê²Œ ê³ ë ¤í•˜ì‹œëŠ” í¸ì…ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ ë›°ì–´ë‚œ ëŠ¥ë ¥ì„ ë°œíœ˜í•˜ì‹¤ ê²ƒ ê°™ë„¤ìš”.</p>
                    `,
                    `
                        <p>ë›°ì–´ë‚œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ë…¼ë¦¬ì  ì‚¬ê³ ë„ ê°€ëŠ¥í•˜ì§€ë§Œ ê°ì •ì  ì¸¡ë©´ì„ ë” ì¤‘ì‹œí•˜ëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ì‹¤ ê²ƒ ê°™ë„¤ìš”.</p>
                    `,
                    `
                        <p>ê°ì •ì  ê³µê° ëŠ¥ë ¥ì´ ë§¤ìš° ë›°ì–´ë‚©ë‹ˆë‹¤.</p>
                        <p>ë…¼ë¦¬ì  íŒë‹¨ê³¼ ê°ì •ì  ê³µê°ì„ ëª¨ë‘ í•  ìˆ˜ ìˆì§€ë§Œ, ê°ì •ì  ì¸¡ë©´ì„ ë” ì¤‘ì‹œí•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ ë›°ì–´ë‚œ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                    `
                ],
                'strong_f': [  // 65-80ì 
                    `
                        <p>ë§¤ìš° ë›°ì–´ë‚œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ì„±í–¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ì‹¤ ê²ƒ ê°™ë„¤ìš”.</p>
                    `,
                    `
                        <p>ì™„ë²½í•œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ì„±í–¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ ë›°ì–´ë‚œ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ë§¤ìš° ë›°ì–´ë‚œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                        <p>ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ì„±í–¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                    `
                ],
                'very_f': [  // 80-100ì 
                    `
                        <p>ì™„ë²½í•œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ì„±í–¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë³´ì—¬ì£¼ì‹¤ ê²ƒ ê°™ë„¤ìš”.</p>
                    `,
                    `
                        <p>ë§¤ìš° ë›°ì–´ë‚œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ê°€ì§€ê³  ê³„ì‹­ë‹ˆë‹¤.</p>
                        <p>ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ì„±í–¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                    `,
                    `
                        <p>ì™„ë²½í•œ ê°ì •ì  ê³µê° ëŠ¥ë ¥ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.</p>
                        <p>ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì„ ê¹Šì´ ì´í•´í•˜ê³  ë°°ë ¤í•˜ëŠ” ì„±í–¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤.</p>
                        <p>ì¸ê°„ê´€ê³„ì—ì„œ íƒì›”í•œ ëŠ¥ë ¥ì„ ë°œíœ˜í•  ìˆ˜ ìˆëŠ” ì„±í–¥ì…ë‹ˆë‹¤.</p>
                    `
                ]
            };
            
            // ì ìˆ˜ êµ¬ê°„ë³„ ì¹´í…Œê³ ë¦¬ ì„ íƒ
            let category;
            if (score < 20) category = 'very_t';
            else if (score < 35) category = 'strong_t';
            else if (score < 45) category = 'mild_t';
            else if (score < 55) category = 'balanced';
            else if (score < 65) category = 'mild_f';
            else if (score < 80) category = 'strong_f';
            else category = 'very_f';
            
            // ëœë¤í•˜ê²Œ í…œí”Œë¦¿ ì„ íƒ
            return reviewTemplates[category][Math.floor(Math.random() * reviewTemplates[category].length)];
        }

        // ì „ì—­ ì˜¤ë””ì˜¤ ê°ì²´ ì„ ì–¸
        let currentAudio = null;
        // TTS ê¸°ëŠ¥
        async function playTTS(text) {
            try {
                const formData = new FormData();
                formData.append('text', text);

                // ê¸°ì¡´ì— ì¬ìƒ ì¤‘ì¸ ì˜¤ë””ì˜¤ê°€ ìˆìœ¼ë©´ ì¤‘ì§€
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio.currentTime = 0;
                    currentAudio = null;
                }

                const response = await fetch(`${API_BASE_URL}/tts`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) throw new Error('TTS ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');

                const blob = await response.blob();
                currentAudio = new Audio(URL.createObjectURL(blob));
                currentAudio.play();
            } catch (error) {
                console.error('TTS Error:', error);
                alert('ìŒì„± ì¬ìƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
    <script>
        // íƒ­ ë²„íŠ¼ ì´ë¯¸ì§€ hover/active ì‹œ ì´ë¯¸ì§€ ë³€ê²½ ë° active ê´€ë¦¬
        document.addEventListener('DOMContentLoaded', function() {
            const tabBtns = document.querySelectorAll('.review-tab-btn');
            tabBtns.forEach(btn => {
                const img = btn.querySelector('img');
                if (!img) return;
                // ìµœì´ˆì— ì›ë³¸ src(í°ìƒ‰)ì™€ data-hover(ë…¸ë€ìƒ‰)ë¥¼ ë³„ë„ ì†ì„±ì— ì €ì¥
                img.setAttribute('data-src-original', img.getAttribute('src'));
                img.setAttribute('data-hover-original', img.getAttribute('data-hover'));

                // Hover íš¨ê³¼
                btn.addEventListener('mouseenter', () => {
                    if (!btn.classList.contains('active')) img.src = img.getAttribute('data-hover-original');
                });
                btn.addEventListener('mouseleave', () => {
                    if (!btn.classList.contains('active')) img.src = img.getAttribute('data-src-original');
                });

                // í´ë¦­ ì‹œ active ê´€ë¦¬ ë° ì´ë¯¸ì§€ ë³€ê²½
                btn.addEventListener('click', () => {
                    tabBtns.forEach(b => {
                        b.classList.remove('active');
                        const i = b.querySelector('img');
                        if (i) {
                            // ëª¨ë“  íƒ­ ì´ë¯¸ì§€ë¥¼ í•­ìƒ src(í°ìƒ‰)ë¡œ ë˜ëŒë¦¼
                            i.src = i.getAttribute('data-src-original');
                        }
                    });
                    btn.classList.add('active');
                    // ì„ íƒëœ íƒ­ë§Œ hover(ë…¸ë€ìƒ‰) ì´ë¯¸ì§€ë¡œ
                    img.src = img.getAttribute('data-hover-original');
                });
            });

            // ìµœì´ˆ í™œì„±í™” íƒ­ ì´ë¯¸ì§€ë„ hoverë¡œ
            const activeBtn = document.querySelector('.review-tab-btn.active');
            if (activeBtn) {
                const img = activeBtn.querySelector('img');
                const hover = img && img.getAttribute('data-hover-original');
                if (img && hover) img.src = hover;
            }
        });
        </script>
</body>
</html>