# MBTI T/F 분석기 - 안전장치가 포함된 실시간 학습 시스템

## 🛡️ 안전장치 개요

이 시스템은 실시간 학습의 안정성을 보장하기 위한 다양한 안전장치가 포함되어 있습니다.

### 주요 안전장치
- ✅ **1주일 단위 자동 백업**: 프롬프트와 성능 데이터 자동 저장
- ✅ **실시간 성능 모니터링**: 현재 성능과 백업 성능 비교
- ✅ **자동 롤백 기능**: 성능 저하 시 이전 안정 버전으로 복구
- ✅ **위험도 평가 시스템**: 다중 지표 기반 위험도 계산
- ✅ **성능 트렌드 분석**: 개선/안정/저하 상태 실시간 분석

## ⚠️ 적용 전 고려사항 및 경고사항

### 🔴 주요 위험 요소
1. **프롬프트 오염 위험**: 잘못된 피드백으로 인한 프롬프트 성능 저하
2. **데이터 손실 위험**: 백업 없이 프롬프트 변경 시 이전 버전 복구 불가
3. **성능 역전 위험**: 개선된 것처럼 보이지만 실제로는 성능 저하
4. **무한 루프 위험**: 잘못된 튜닝으로 인한 성능 악화 반복

### 🟡 주의사항
1. **사용자 피드백 품질**: 부정확한 예상 점수 입력 시 전체 시스템 성능 저하
2. **데이터 편향**: 특정 유형의 사용자만 피드백 제공 시 편향된 학습
3. **과적합 위험**: 특정 데이터셋에만 최적화되어 일반화 성능 저하
4. **시스템 복잡성**: 추가된 기능으로 인한 시스템 안정성 저하

### 🟢 권장사항
1. **단계적 적용**: 소규모 테스트 후 점진적 확대
2. **정기적 백업**: 주간 백업 및 성능 모니터링
3. **롤백 계획**: 성능 저하 시 이전 버전으로 복구
4. **사용자 교육**: 정확한 피드백 제공 방법 안내

## 🎯 안전장치 기준

### 백업 시스템
- **백업 주기**: 1주일 (7일)
- **백업 내용**: 프롬프트, 성능 데이터, 평균 오차율
- **백업 위치**: `prompt_backups/` 디렉토리
- **백업 형식**: JSON 파일 + SQLite 데이터베이스

### 위험도 계산
- **오차율 증가**: 현재 오차율 > 백업 오차율 + 15%
- **성능 트렌드**: 최근 5개 vs 이전 5개 비교
- **백업 지연**: 마지막 백업으로부터 7일 이상 경과
- **높은 오차율**: 현재 오차율 > 15%

### 롤백 조건
- **자동 롤백**: 성능 15% 이상 저하 시
- **수동 롤백**: 높은 위험도 시 사용자 확인
- **롤백 대상**: 마지막 안정 백업 버전

## 🌐 웹 인터페이스 접속

1. **메인 페이지**: http://localhost:8001/safe_index_with_learning.html
2. **API 상태**: http://localhost:8001/api/v1/learning/status
3. **안전성 지표**: http://localhost:8001/api/v1/safety/metrics
4. **백업 목록**: http://localhost:8001/api/v1/safety/backups

## 💡 사용 방법

### 1단계: 시스템 시작
```bash
python run_safe_realtime_learning.py
```

### 2단계: 웹 브라우저 접속
- http://localhost:8001/safe_index_with_learning.html 접속

### 3단계: 안전성 모니터링
1. 안전성 패널에서 위험도 확인
2. 현재 오차율 vs 백업 오차율 비교
3. 성능 트렌드 분석
4. 백업 정보 확인

### 4단계: 분석 및 학습
1. 텍스트 입력란에 분석할 답변 입력
2. "분석하기" 버튼 클릭
3. 분석 결과 확인
4. 피드백 제출 (예상 점수 입력)

### 5단계: 롤백 필요 시
1. 높은 위험도 감지 시 경고 확인
2. 성능 저하 확인
3. "롤백 수행" 버튼 클릭
4. 확인 후 롤백 실행

## 📊 안전성 모니터링 패널

### 위험도 지표
- **낮은 위험**: 초록색 - 정상 운영
- **중간 위험**: 노란색 - 주의 필요
- **높은 위험**: 빨간색 - 롤백 고려

### 성능 지표
- **현재 오차율**: 최근 50개 입력의 평균 오차
- **백업 오차율**: 마지막 백업 시점의 평균 오차
- **성능 트렌드**: 개선/안정/저하 상태
- **백업 경과일**: 마지막 백업으로부터 경과일

### 백업 정보
- **백업 버전**: 백업 시점의 프롬프트 버전
- **백업일**: 백업 생성 날짜
- **평균 오차율**: 백업 시점의 평균 오차
- **안정성**: 안정/불안정 상태

## 🔧 API 엔드포인트

### 안전성 관련 API
```http
GET /api/v1/safety/metrics
```
안전성 지표 조회

```http
POST /api/v1/safety/rollback
Content-Type: application/json

{
  "confirm": true
}
```
롤백 수행

```http
POST /api/v1/safety/backup
```
백업 생성

```http
GET /api/v1/safety/backups
```
백업 목록 조회

### 학습 관련 API
```http
POST /api/v1/analyze_with_safety
Content-Type: application/json

{
  "text": "분석할 텍스트"
}
```
안전장치가 포함된 분석

## 📈 안전장치 작동 방식

### 1. 실시간 모니터링
- 30초마다 성능 지표 업데이트
- 현재 성능과 백업 성능 비교
- 위험도 계산 및 표시

### 2. 백업 시스템
- 1주일마다 자동 백업 생성
- 백업 정보 데이터베이스 저장
- 백업 파일 JSON 형태로 저장

### 3. 롤백 시스템
- 성능 저하 감지 시 자동 롤백 고려
- 사용자 확인 후 수동 롤백 실행
- 롤백 이벤트 로그 기록

### 4. 위험도 평가
- 오차율 증가 위험
- 성능 저하 위험
- 백업 지연 위험
- 높은 오차율 위험

## 🗄️ 데이터베이스 구조

### safety_metrics 테이블
- `id`: 고유 식별자
- `check_date`: 검사 날짜
- `current_error_rate`: 현재 오차율
- `backup_error_rate`: 백업 오차율
- `performance_trend`: 성능 트렌드
- `risk_level`: 위험도 레벨
- `action_taken`: 수행된 조치

### prompt_backups 테이블
- `id`: 고유 식별자
- `version`: 백업 버전
- `prompt`: 프롬프트 내용
- `backup_date`: 백업 날짜
- `average_error`: 평균 오차율
- `performance_data`: 성능 데이터
- `is_stable`: 안정성 여부

## ⚠️ 주의사항

### 시스템 운영
1. **정확한 피드백**: 부정확한 예상 점수는 전체 시스템 성능 저하
2. **정기적 모니터링**: 안전성 지표 정기 확인
3. **백업 관리**: 백업 파일 정기적 확인
4. **롤백 준비**: 성능 저하 시 빠른 대응

### 데이터 관리
1. **데이터베이스 백업**: `safe_learning_data.db` 정기 백업
2. **백업 파일 관리**: `prompt_backups/` 디렉토리 관리
3. **로그 관리**: 시스템 로그 정기 확인
4. **성능 기록**: 성능 변화 추이 기록

## 🛠️ 문제 해결

### 높은 위험도 발생 시
1. **원인 분석**: 오차율 증가 원인 파악
2. **피드백 품질**: 사용자 피드백 정확성 확인
3. **롤백 고려**: 이전 안정 버전으로 복구
4. **시스템 재시작**: 필요시 시스템 재시작

### 백업 문제
```bash
# 백업 디렉토리 확인
ls prompt_backups/

# 수동 백업 생성
curl -X POST http://localhost:8001/api/v1/safety/backup

# 백업 목록 확인
curl http://localhost:8001/api/v1/safety/backups
```

### 롤백 실행
```bash
# 롤백 수행
curl -X POST http://localhost:8001/api/v1/safety/rollback \
  -H "Content-Type: application/json" \
  -d '{"confirm": true}'
```

## 📝 예시 사용 시나리오

### 시나리오 1: 정상 운영
1. 시스템 시작 및 안전성 확인
2. 정상적인 분석 및 피드백 제공
3. 주간 백업 자동 생성
4. 성능 지속적 개선

### 시나리오 2: 성능 저하 감지
1. 높은 위험도 경고 확인
2. 성능 지표 분석
3. 롤백 필요성 판단
4. 롤백 실행 또는 추가 모니터링

### 시나리오 3: 백업 관리
1. 백업 주기 확인
2. 백업 정보 검토
3. 필요시 수동 백업 생성
4. 백업 파일 관리

## 🎉 성공 지표

### 안전성 지표
- **위험도**: 80% 이상 낮은 위험도 유지
- **백업 주기**: 1주일마다 정상 백업
- **롤백 빈도**: 월 1회 이하
- **시스템 안정성**: 99% 이상 가동률

### 성능 지표
- **허용 비율**: 80% 이상 달성
- **평균 오차**: 5% 이하 달성
- **성능 트렌드**: 지속적 개선 또는 안정
- **사용자 만족도**: 정확한 분석 결과

---

**안전장치가 포함된 실시간 학습 시스템으로 안정적이고 신뢰할 수 있는 MBTI T/F 분석을 제공합니다!** 🛡️ 